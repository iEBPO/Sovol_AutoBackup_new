[gcode_macro SET_TEMP_OFFSET]
description: Автоматическая корректировка Z-offset по температуре
variable_T: 0
variable_Z_OFFSET: 0
gcode:
  {% set T = params.TEMP|default(200)|float %}
  {% set Z_BASE = 0 %}
  {% set ALPHA = 0.000385 %}
  {% set Z_OFFSET = Z_BASE + ALPHA * (T - 150) %}
  SET_GCODE_OFFSET Z_ADJUST={Z_OFFSET}
  RESPOND TYPE=command MSG="Z-offset = {Z_OFFSET:.3f} мм (T={T}°C)"